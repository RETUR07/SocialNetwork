version: "3.9"

services:   
  web:
    ports:
      - "5050:80"
    depends_on:
      - rabbitmq
    build:
      context: ./
      dockerfile: DockerfileSocialNetwork
    
    environment:
      - JWT:Secret=${SecretJWTKey}
      - ASPNETCORE_ENVIRONMENT=Development
      - ConnectionStrings:sqlConnection=${ConnectionToDB}
      - ConnectionStrings:AzureBlobStorage=${ConnectionToBlob}
    restart: on-failure


    
  IdentityTokenServer:
    ports:
      - "9001:9001"
    depends_on:
      - rabbitmq
    build:
      context: ./
      dockerfile: DockerfileIdentityServer4
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ConnectionStrings:sqlConnection=Data Source=host.docker.internal\SQLExpress, 1433; database=SocialNetworkDb; User ID=sa;Password=root;MultipleActiveResultSets=true;
    restart: on-failure

